<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://static.wangminghuan.cn/cdn/fontawesome@5.15.3/all.min.css">
  <link rel="stylesheet" href="https://static.wangminghuan.cn/cdn/animejs@3.2.1/animate.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"wangminghuan.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.10.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

  <meta name="description" content="概述一次在跟同事讨论中忽然萌生了自己手动搭建一套上线系统的想法，第一次上手，所以选用了业内比较成熟的方案-jenkins。之前只是用过jenkins进行过一些操作，并未自己从0到1完成搭建，本文记录下自己整个过程中的遇到的一些问题与解决方案。">
<meta property="og:type" content="article">
<meta property="og:title" content="jenkins搭建前端上线系统小试">
<meta property="og:url" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/index.html">
<meta property="og:site_name" content="WMH&#39;s Blog">
<meta property="og:description" content="概述一次在跟同事讨论中忽然萌生了自己手动搭建一套上线系统的想法，第一次上手，所以选用了业内比较成熟的方案-jenkins。之前只是用过jenkins进行过一些操作，并未自己从0到1完成搭建，本文记录下自己整个过程中的遇到的一些问题与解决方案。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/1.jpg">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/1.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/2.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/3.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/4.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/5.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/6.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/7.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/8.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/9.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/10.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/11.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/12.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/16.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/14.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/17.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/18.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/20.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/21.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/22.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/24.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/25.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/26.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/27.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/28.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/31.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/29.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/30.png">
<meta property="og:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/32.png">
<meta property="article:published_time" content="2019-09-24T16:49:47.000Z">
<meta property="article:modified_time" content="2022-05-17T10:04:10.821Z">
<meta property="article:author" content="WMH">
<meta property="article:tag" content="jenkins">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/1.jpg">


<link rel="canonical" href="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/","path":"jenkins搭建前端上线系统小试/","title":"jenkins搭建前端上线系统小试"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>jenkins搭建前端上线系统小试 | WMH's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">WMH's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-主页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="nav-number">2.</span> <span class="nav-text">准备知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A-docker%E5%AE%89%E8%A3%85"><span class="nav-number">3.</span> <span class="nav-text">方案一： docker安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#centos%E4%B8%8A%E5%AE%89%E8%A3%85docker"><span class="nav-number">3.1.</span> <span class="nav-text">centos上安装docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-docker"><span class="nav-number">3.2.</span> <span class="nav-text">关于 docker</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8-Docker%EF%BC%9F"><span class="nav-number">3.2.1.</span> <span class="nav-text">前端为什么需要使用 Docker？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker-%E4%B8%AD%E7%9A%84%E4%B8%89%E4%B8%AA%E6%A6%82%E5%BF%B5"><span class="nav-number">3.2.2.</span> <span class="nav-text">Docker 中的三个概念</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E5%AE%89%E8%A3%85jenkins"><span class="nav-number">3.3.</span> <span class="nav-text">docker 安装jenkins</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jenkins-%E9%85%8D%E7%BD%AEnodejs"><span class="nav-number">3.4.</span> <span class="nav-text">jenkins 配置nodejs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jenkins-github-%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.5.</span> <span class="nav-text">jenkins + github 配置项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#doker-%E6%A8%A1%E5%BC%8F%E4%B8%8B%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.6.</span> <span class="nav-text">doker 模式下遇到的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPM%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85jenkins"><span class="nav-number">4.</span> <span class="nav-text">RPM方式安装jenkins</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85java%E7%8E%AF%E5%A2%83"><span class="nav-number">4.1.</span> <span class="nav-text">安装java环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BDrpm%E5%8C%85%EF%BC%9A"><span class="nav-number">4.2.</span> <span class="nav-text">下载rpm包：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85jenkins"><span class="nav-number">4.3.</span> <span class="nav-text">安装jenkins</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8jenkins"><span class="nav-number">4.4.</span> <span class="nav-text">启动jenkins</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#node%E8%B0%83%E7%94%A8centos%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE"><span class="nav-number">4.5.</span> <span class="nav-text">node调用centos全局配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E5%96%84%E6%95%B4%E4%B8%AA%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="nav-number">4.6.</span> <span class="nav-text">完善整个构建流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E7%BB%88%E6%9E%84%E5%BB%BA%E6%95%88%E6%9E%9C"><span class="nav-number">4.7.</span> <span class="nav-text">最终构建效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">5.</span> <span class="nav-text">遇到的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AEgit-diff-%E9%80%89%E6%8B%A9%E6%80%A7%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">根据git diff 选择性上传文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jenkins%E7%9A%84%E5%85%B6%E4%BB%96%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F"><span class="nav-number">7.</span> <span class="nav-text">jenkins的其他安装方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generic-Webhook-Trigger-Plugin"><span class="nav-number">8.</span> <span class="nav-text">Generic Webhook Trigger Plugin</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E9%83%A8%E5%88%86%E9%85%8D%E7%BD%AE"><span class="nav-number">9.</span> <span class="nav-text">权限部分配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">10.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E8%83%BD%E7%94%A8%E5%88%B0%E7%9A%84linux%E5%91%BD%E4%BB%A4"><span class="nav-number">11.</span> <span class="nav-text">可能用到的linux命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A5%E5%85%85%EF%BC%9A%E5%A2%9E%E5%8A%A0swap%E5%88%86%E5%8C%BA%E8%A7%A3%E5%86%B3%E9%98%BF%E9%87%8C%E4%BA%91%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3"><span class="nav-number">12.</span> <span class="nav-text">补充：增加swap分区解决阿里云内存不足</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">13.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="WMH"
      src="/images/avatar2.png">
  <p class="site-author-name" itemprop="name">WMH</p>
  <div class="site-description" itemprop="description">just code it</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">101</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wangminghuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangminghuan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:m.h.wang@foxmail.com" title="E-Mail → mailto:m.h.wang@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weblog.wangminghuan.cn/" title="WebSite → https:&#x2F;&#x2F;weblog.wangminghuan.cn" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>WebSite</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/1657970003?topnav=1&wvr=6&topsug=1&is_all=1" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;1657970003?topnav&#x3D;1&amp;wvr&#x3D;6&amp;topsug&#x3D;1&amp;is_all&#x3D;1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangminghuan.github.io/jenkins%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E4%B8%8A%E7%BA%BF%E7%B3%BB%E7%BB%9F%E5%B0%8F%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.png">
      <meta itemprop="name" content="WMH">
      <meta itemprop="description" content="just code it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WMH's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          jenkins搭建前端上线系统小试
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-24 16:49:47" itemprop="dateCreated datePublished" datetime="2019-09-24T16:49:47+00:00">2019-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-17 10:04:10" itemprop="dateModified" datetime="2022-05-17T10:04:10+00:00">2022-05-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>一次在跟同事讨论中忽然萌生了自己手动搭建一套上线系统的想法，第一次上手，所以选用了业内比较成熟的方案-jenkins。之前只是用过jenkins进行过一些操作，并未自己从0到1完成搭建，本文记录下自己整个过程中的遇到的一些问题与解决方案。</p>
<span id="more"></span>

<h2 id="准备知识"><a href="#准备知识" class="headerlink" title="准备知识"></a>准备知识</h2><p>linux安装软件的方式（知道的可以直接跳过本节）：</p>
<p>一般有三种方式：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36119192/article/details/82866329">Linux系统中安装软件的几种方式</a>  </p>
<ol>
<li><p>源码包安装：<br> 下载源码 -&gt; 解压 -&gt; 运行configure配置等 -&gt; make 编译 -&gt; make  install 安装</p>
</li>
<li><p>rpm包安装：<br>RedHat Package Manager，由红帽公司提出，建议统一的数据库文件，详细记录软件包的安装、卸载等变化信息，能够自动分析软件包依赖关系。用RPM工具可以将二进制程序进行打包，包被称为RPM包。RPM包并不是跨平台的。</p>
</li>
<li><p>yum源安装：<br>Yellow dog Updater, Modified, 是一个在Fedora和RedHat以及CentOS中的Shell前端软件包管理器。基于RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装</p>
</li>
</ol>
<p>linux启动服务管理两种方式service和systemctl：</p>
<p>service作为启动init进程的主命令存在一些历史缺陷，Systemd就是他的升级版，他为系统的启动和管理提供一套完整的解决方案。Systemd 并不是一个命令，而是一组命令，涉及到系统管理的方方面面：systemctl是 Systemd 的主命令，用于管理系统。</p>
<h2 id="方案一：-docker安装"><a href="#方案一：-docker安装" class="headerlink" title="方案一： docker安装"></a>方案一： docker安装</h2><p>docker作为目前比较火的一个名词，自己一直没机会使用，了解到jenkins可以通过docker来安装，于是，从docker开始，进入了采坑之旅。</p>
<h3 id="centos上安装docker"><a href="#centos上安装docker" class="headerlink" title="centos上安装docker"></a>centos上安装docker</h3><p>自己的服务器为阿里云，版本如下（以下所有操作均是基于此台机器）：</p>
<pre><code>uname -a
Linux iZ2zeb34hcp1ui0lowu4atZ 3.10.0-957.5.1.el7.x86_64 #1 SMP Fri Feb 1 14:54:57 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
</code></pre>
<p>docker的安装还是比较简单的，参照<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/51853.html">阿里云官方文档</a>几分钟搞定：</p>
<p>添加yum源</p>
<pre><code>  # yum install epel-release –y // 安装并启用 EPEL 源。
  # yum clean all
  # yum list
</code></pre>
<p>安装并运行Docker</p>
<pre><code>  # yum install docker-io –y
  # systemctl start docker // 启动docker服务
</code></pre>
<p>检查安装结果。</p>
<pre><code>  # docker info
</code></pre>
<h3 id="关于-docker"><a href="#关于-docker" class="headerlink" title="关于 docker"></a>关于 docker</h3><p>“Docker” 的本质其实是解决了应用服务的 “隐私” 问题，实现进程、内存、文件、网络之间相互隔离。也可以简单把 Docker 理解成一种虚拟机，很多应用服务可以像桌面软件那样一键安装，免部署和环境配置。</p>
<h4 id="前端为什么需要使用-Docker？"><a href="#前端为什么需要使用-Docker？" class="headerlink" title="前端为什么需要使用 Docker？"></a>前端为什么需要使用 Docker？</h4><ol>
<li>对于 Full Stack 工程师。Docker 可以提供一种简单轻便的服务器编程环境，而且可以随用随删、降低环境配置成本。</li>
<li>很多 FE 日常工作中需要跟 Nginx、MongoDB、MySQL 等服务器应用打交道。用 Docker 可以很容易部署一个测试环境，学习和倒腾.</li>
</ol>
<h4 id="Docker-中的三个概念"><a href="#Docker-中的三个概念" class="headerlink" title="Docker 中的三个概念"></a>Docker 中的三个概念</h4><pre><code>Container - 容器
Image - 镜像
Registry - 仓库
</code></pre>
<p>可以像下面这张图来类比：</p>
<p><img src="1.jpg"></p>
<h3 id="docker-安装jenkins"><a href="#docker-安装jenkins" class="headerlink" title="docker 安装jenkins"></a>docker 安装jenkins</h3><p>使用下面的 docker run 命令运行 jenkinsci/blueocean 镜像作为Docker中的一个容器(如果本地没有镜像，这个命令会自动下载):</p>
<pre><code>docker run \
  --rm \
  -u root \
  -p 8080:8080 \
  -v jenkins-data:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v &quot;$HOME&quot;:/home \
  jenkinsci/blueocean
</code></pre>
<p>此时就进入jenkins安装流程，具体参照此处<a target="_blank" rel="noopener" href="https://jenkins.io/zh/doc/tutorials/build-a-node-js-and-react-app-with-npm/#setup-wizard">jenkins官网安装示例</a>：</p>
<p>启动服务，输入密码继续(安装过程忘记截图了，以下图收集于网络)；</p>
<p><img src="1.png"></p>
<p>启动后安装推荐插件:</p>
<p><img src="2.png"><br><img src="3.png"><br>安装插件完成后，进入设置初始账号密码:</p>
<p><img src="4.png"></p>
<p>设置完毕即可进入jenkins主页：</p>
<p><img src="5.png"></p>
<p>可能遇到的问题：<br>1.访问接口出现：Error:403 No valid crumb was included in the request<br>解决：关闭安全设置里面的-防止款站点请求伪造选项，具体参照<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/959a7d07273f">此处</a>。</p>
<h3 id="jenkins-配置nodejs"><a href="#jenkins-配置nodejs" class="headerlink" title="jenkins 配置nodejs"></a>jenkins 配置nodejs</h3><p>进入插件管理，安装Nodejs Plugin: </p>
<p><img src="6.png"></p>
<p>进入全局工具配置，配置项目中会用到的nodejs版本，可以配置多个</p>
<p><img src="7.png"></p>
<h3 id="jenkins-github-配置项目"><a href="#jenkins-github-配置项目" class="headerlink" title="jenkins + github 配置项目"></a>jenkins + github 配置项目</h3><p>开始创建项目，选择自由风格：</p>
<p><img src="8.png"></p>
<p>开始配置项目（以github私有项目为例）</p>
<p><img src="9.png"></p>
<p>此处我们填写完git地址后需要添加凭证，添加其他个人私有密钥不知道为啥一直在下拉菜单中选不到，添加用户名密码则可以，暂时还不知道啥原因~</p>
<p><img src="10.png"></p>
<p><img src="11.png"></p>
<p>触发器中我们选择hook，push之后，自动触发构建</p>
<p><img src="12.png"></p>
<p>此处在github中也要做对应配置才可出发hook功能：<br><img src="16.png"></p>
<p>也可以自定义配置，譬如，push 与 merge时触发，选择Let me select individual events，勾选以下选项：</p>
<pre><code>Deployments
Deployment statuses
Pull requests
Pushes
</code></pre>
<p>接下来我们配置拉去完代码后需要执行的脚本，centos上我们选择shell脚本：</p>
<p><img src="14.png"></p>
<p>至此，一个简单的配置已经完毕，可以进行自动构建测试了！！</p>
<h3 id="doker-模式下遇到的问题"><a href="#doker-模式下遇到的问题" class="headerlink" title="doker 模式下遇到的问题"></a>doker 模式下遇到的问题</h3><p>我们随便改一点东西，向master分支push代码，触发构建；构建任务正常触发，但执行到shell脚本时却出现了异常：</p>
<pre><code>[test-project] $ /bin/sh -xe /tmp/jenkins6958996694563138608.sh
+ node -v
/tmp/jenkins6958996694563138608.sh: line 2: node: not found
Build step &#39;Execute shell&#39; marked build as failure
Finished: FAILURE
</code></pre>
<p>通过<code>docker exec -it 4c0fd5e5f2c5 bash</code> 命令进入容器内部bash访问：</p>
<pre><code>    cd /var/jenkins_home/tools/jenkins.plugins.nodejs.tools.NodeJSInstallation/nodejs_10.15.3/
</code></pre>
<p>nodejs文件夹存在，但执行 <code>bin/node -v</code> 报错，提示 : No such file or directory</p>
<p>解决：终于在<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/43307107/jenkins-nodejsplugin-node-command-not-found">stackoverflow</a> 翻到一个大佬的回答，原因如下：</p>
<pre><code>This happens because the image doesn&#39;t contain libstdc++.so.6 as needed by nodejs
    
In other words, node: not found does not mean node is not installed (it is, it is executable and found in the $PATH).  
     
It means one of node dependencies is not found.
</code></pre>
<p>我们通过，手动安装：</p>
<pre><code>apk add --no-cache --update nodejs nodejs-npm
</code></pre>
<p>拉取的是Node.js Alpine <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33735077/article/details/91372328">镜像</a>，这个镜像做个优化，并没有内置npm包（本人验证 10.14.2是没有的）需要手动再安装npm；</p>
<p>再次构建</p>
<pre><code>/var/jenkins_home/tools/jenkins.plugins.nodejs.tools.NodeJSInstallation/nodejs_10.15.3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/jvm/java-1.8-openjdk/jre/bin:/usr/lib/jvm/java-1.8-openjdk/bin
+ node -v
v10.14.2
+ npm -v
6.4.1
Finished: SUCCESS
</code></pre>
<p>执行成功，考虑到调试困难和后续还需要全局安装vue-cli3.0 于是决定放弃docker方式，改用RPM方式再次安装jenkins</p>
<h2 id="RPM方式安装jenkins"><a href="#RPM方式安装jenkins" class="headerlink" title="RPM方式安装jenkins"></a>RPM方式安装jenkins</h2><p>因为Jenkins是基于java的,所以需要先安装jdk</p>
<h3 id="安装java环境"><a href="#安装java环境" class="headerlink" title="安装java环境"></a>安装java环境</h3><pre><code>sudo yum install java
</code></pre>
<h3 id="下载rpm包："><a href="#下载rpm包：" class="headerlink" title="下载rpm包："></a>下载rpm包：</h3><p> 通过<a target="_blank" rel="noopener" href="https://pkg.jenkins.io/redhat-stable/">RedHat Linux RPM packages for Jenkins</a>网站下载所需的rpm包，我安装的是jenkins-2.195-1.1.noarch.rpm</p>
<h3 id="安装jenkins"><a href="#安装jenkins" class="headerlink" title="安装jenkins"></a>安装jenkins</h3><pre><code>sudo rpm -ih jenkins-2.73.2-1.1.noarch.rpm
</code></pre>
<p>自动安装完成之后： </p>
<p>/usr/lib/jenkins/jenkins.war    WAR包 </p>
<p>/etc/sysconfig/jenkins       配置文件</p>
<p>/var/lib/jenkins/       默认的JENKINS_HOME目录</p>
<p>/var/log/jenkins/jenkins.log    Jenkins日志文件</p>
<h3 id="启动jenkins"><a href="#启动jenkins" class="headerlink" title="启动jenkins"></a>启动jenkins</h3><pre><code>sudo systemctl start jenkins.service
</code></pre>
<p>之后的操作与上一步docker安装方式基本一摸一样，唯一区别的就是器nodejs安装方式</p>
<h3 id="node调用centos全局配置"><a href="#node调用centos全局配置" class="headerlink" title="node调用centos全局配置"></a>node调用centos全局配置</h3><p>取消构建环境配置下的：Provide Node &amp; npm bin/ folder to PATH 即可</p>
<h3 id="完善整个构建流程"><a href="#完善整个构建流程" class="headerlink" title="完善整个构建流程"></a>完善整个构建流程</h3><p>其实主要就是shell脚本的编写，项目中配置如下(新建了另外一个项目vue-build-project)：</p>
<pre><code>node -v 
echo &quot;开始安装依赖...&quot;
npm install
echo &quot;开始打包...&quot;
npm run build

base=&quot;/home/upload-upyun&quot;
dest=&quot;vue-build-project&quot;
cp -r ./dist  $&#123;base&#125;/$&#123;dest&#125;
echo &quot;开始上传...&quot;
node  $&#123;base&#125;/index.js $&#123;dest&#125;
rm -rf $&#123;base&#125;/$&#123;dest&#125;
</code></pre>
<p><code>/home/upload-upyun/index.js</code> 内容如下：</p>
<pre><code>const argPath=(process.argv.splice(2));//通过透传参数获取文件夹目录
const uploadFolder=(argPath[0]?argPath[0]:&#39;&#39;).replace(/^--/g,&#39;&#39;);
const rootPath=(argPath[1]?argPath[1]:&#39;&#39;).replace(/^--/g,&#39;&#39;); //静态资源服务器的上传根路径
const fs=require(&quot;fs&quot;);
const path=require(&quot;path&quot;);
const upyun = require(&quot;upyun/dist/upyun.common&quot;);
const localFileArr=[];
function readPathSync (p) &#123;
  if(!fs.existsSync(p)) return;
  const stat = fs.statSync(p)
  if (stat.isDirectory()) &#123;
    const ls = fs.readdirSync(p).map(file =&gt; path.join(p, file))
    for (let i = 0; i &lt; ls.length; i++) &#123;
      readPathSync(ls[i])
    &#125;
  &#125; else &#123;
    localFileArr.push(p)
  &#125;
&#125;
const ypyConf=&#123;
    &quot;serviceName&quot; : &quot;xxx&quot;,
    &quot;operatorName&quot; : &quot;xxx&quot;,
    &quot;password&quot; :&quot;xxx&quot;,
    &quot;remotePath&quot; rootPath,
&#125;;

  // 需要填写本地路径，云存储路径
  const remoteRoot = ypyConf.remotePath;
  const upService = new upyun.Service(ypyConf.serviceName, ypyConf.operatorName, ypyConf.password);
  const upClient = new upyun.Client(upService);
  const prefix=(path.join(__dirname))
  // 上传参数
  // console.log(upClient)
  function uploadFile(localFile)&#123;
    const remoteFile= remoteRoot+(localFile.replace(prefix,&#39;&#39;)).split(path.sep).join(&quot;/&quot;)
    upClient.putFile(remoteFile, fs.createReadStream(localFile), &#123;
      &#39;Date&#39;: new Date(),
      &#39;Content-Length&#39;: fs.statSync(localFile).size,
    &#125;).then(res =&gt; &#123;
      if (res) &#123;
        console.log(remoteFile+&quot;:上传成功&quot;)
      &#125; else &#123;
        console.log(remoteFile+&quot;:上传失败&quot;)
      &#125;
    &#125;).catch(err =&gt; &#123;
      console.log(&quot;上传出现异常！&quot;)
    &#125;)
&#125;
readPathSync(path.join(__dirname,uploadFolder));
localFileArr.map((item)=&gt;&#123;
  uploadFile(item)
&#125;)
</code></pre>
<h3 id="最终构建效果"><a href="#最终构建效果" class="headerlink" title="最终构建效果"></a>最终构建效果</h3><pre><code>16:21:48 [vue-build-project] $ /bin/sh -xe /tmp/jenkins8111626610056806132.sh
16:21:48 + node -v
16:21:48 v10.15.3
16:21:48 + echo 开始安装依赖...
16:21:48 开始安装依赖...
16:21:48 + echo 开始打包...
16:21:48 开始打包...
16:21:48 [vue-build-project] $ /bin/sh -xe /tmp/jenkins6507915611034625552.sh
16:21:48 + cd /var/lib/jenkins/workspace
16:21:48 + cd vue-build-project
16:21:48 + cp -r ./dist /home/upload-upyun/vue-build-project
16:21:48 + echo 开始上传...
16:21:48 开始上传...
16:21:48 + node /home/upload-upyun/index.js vue-build-project
16:21:48 /test/vue-build-project/favicon.ico:上传成功
16:21:48 /test/vue-build-project/index.html:上传成功
16:21:48 /test/vue-build-project/static/js/app.6e3674b9.js:上传成功
16:21:48 /test/vue-build-project/static/css/app.e2713bb0.css:上传成功
16:21:48 /test/vue-build-project/static/img/logo.82b9c7a5.png:上传成功
16:21:48 /test/vue-build-project/static/js/chunk-vendors.a1771d7d.js:上传成功
16:21:48 + rm -rf /home/upload-upyun/vue-build-project
16:21:48 Finished: SUCCESS
</code></pre>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>在npm install 这一步出现了一个问题困扰了我两天，执行过程中jenkins进程会忽然挂掉,一直以为是配置的问题，后来忽然意识到可能是被centos给干掉了，查看日志：</p>
<pre><code>grep &quot;Out of memory&quot; /var/log/messages
</code></pre>
<p>得到日志如下：</p>
<p><img src="17.png"></p>
<p>时间节点与我构建时完全相同！！！！，坑啊！！！查阅资料明白是触发了 <a target="_blank" rel="noopener" href="https://blog.51cto.com/vaedit/2112627">linux 的 OOM killer 机制</a>：</p>
<p>于是乎重启服务器，只开启Jenkins，重新构建。我的阿里云服务器可怜的1G内存在构建过程中的内存变化如下：</p>
<p><img src="18.png"></p>
<p>所以，都是贫穷惹的祸~</p>
<h2 id="根据git-diff-选择性上传文件"><a href="#根据git-diff-选择性上传文件" class="headerlink" title="根据git diff 选择性上传文件"></a>根据git diff 选择性上传文件</h2><p>有些情况下，我们只需要上传变动的文件，并不需要上传所有文件，此时shell部分可以这样编写：</p>
<pre><code>diff=`git diff --name-only HEAD~1 HEAD~0`
base=&quot;/home/upload-upyun&quot;
dest=&quot;static-demo&quot;
rm -rf $&#123;base&#125;/$&#123;dest&#125;
# 创建目标文件夹
mkdir -p $&#123;base&#125;/$&#123;dest&#125;
# 循环复制变动文件(被删除文件忽略，只做新增与覆盖)
for line in $diff
do 
if [ -f $line ];then
  cp --parents -afv $line $&#123;base&#125;/$&#123;dest&#125;
fi
done

echo &quot;开始上传...&quot;
node  $&#123;base&#125;/index.js --$&#123;dest&#125;
rm -rf $&#123;base&#125;/$&#123;dest&#125;
</code></pre>
<h2 id="jenkins的其他安装方式"><a href="#jenkins的其他安装方式" class="headerlink" title="jenkins的其他安装方式"></a>jenkins的其他安装方式</h2><p>也可以通过以下方式安装Jenkins，本文不再尝试，效果与rpm方式理论应该等同，具体可参照:</p>
<ol>
<li>yum进行安装：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lazycheerup/article/details/83928548">jenkins yum 安装</a></li>
<li>war包安装：<a target="_blank" rel="noopener" href="https://blog.51cto.com/bigboss/2129358">WAR包方式安装Jenkins</a></li>
</ol>
<h2 id="Generic-Webhook-Trigger-Plugin"><a href="#Generic-Webhook-Trigger-Plugin" class="headerlink" title="Generic Webhook Trigger Plugin"></a>Generic Webhook Trigger Plugin</h2><p>上述的webhook是通过github-plugin 进行触发，但对于其他git托管，如腾讯云，阿里云，码云等其他第三方git服务提供平台，并没有对应的插件，此时，就轮到 <code>Generic Webhook Trigger Plugin</code> 插件登场：  </p>
<p>首先，进行安装，过程省略。安装完毕后在项目配置页面可以看到多出一个配置：</p>
<p><img src="20.png"></p>
<p>我们需要拿到webhook的地址，根据官方文档可以知道，我们需要拿到Jenkins管理员的API token, 进入管理用户页面，选择admin生成一个：</p>
<p><img src="21.png"></p>
<p>最终得到的webhook地址为：<code>http://xxx:8080/generic-webhook-trigger/invoke?token=11d85c3af55e018axxxxxx</code>, 这里我们以腾讯云为例，配置下webhook:</p>
<p><img src="22.png"></p>
<p>我们再回到项目配置页面，需要对该插件做一些配置, 默认我们配置好webhook后，所有配置过该webhook的页面，所有项目与分支的任意一个变动都可以触发所有项目的构建，这显然不是我想要的，我们需要做一些区分，参照<a target="_blank" rel="noopener" href="https://blog.csdn.net/xlgen157387/article/details/76216351">此文章</a>：  </p>
<ol>
<li>区分分支</li>
</ol>
<p><img src="24.png"></p>
<ol start="2">
<li>区分项目（不同服务提供商字段会有差异，腾讯云是在repository下）</li>
</ol>
<p><img src="25.png"></p>
<ol start="3">
<li>配置token</li>
</ol>
<p><img src="26.png"></p>
<ol start="4">
<li>过滤字段匹配项目（此处为每个项目特有配置，区分好项目与分支）</li>
</ol>
<p><img src="27.png"></p>
<p>我们手动构建一次可以看到webhook返回结果如下：</p>
<pre><code>&#123;
  &quot;ref&quot;: &quot;refs/heads/dev&quot;,
  &quot;before&quot;: &quot;6b53d96f0ee3dc5b1b60d389105d330641ac1612&quot;,
  &quot;after&quot;: &quot;9370030232017ff649a070ae6bf1bdd7522a037c&quot;,
  &quot;created&quot;: false,
  &quot;deleted&quot;: false,
  &quot;compare&quot;: &quot;\u003ca href\u003d\u0027https://coding.net/u/wangminghuan/p/jenkins-autoupload\u0027 target\u003d\u0027_blank\u0027\u003ejenkins-autoupload\u003c/a\u003e/git/compare/6b53d96f0ee3d...9370030232017&quot;,
  &quot;commits&quot;: [&#123;
    &quot;id&quot;: &quot;9370030232017ff649a070ae6bf1bdd7522a037c&quot;,
    &quot;distinct&quot;: false,
    &quot;message&quot;: &quot;fix:添加文件\n&quot;,
    &quot;timestamp&quot;: 1569831379000,
    &quot;url&quot;: &quot;\u003ca href\u003d\u0027https://coding.net/u/wangminghuan/p/jenkins-autoupload\u0027 target\u003d\u0027_blank\u0027\u003ejenkins-autoupload\u003c/a\u003e/git/commit/9370030232017ff649a070ae6bf1bdd7522a037c&quot;,
    &quot;author&quot;: &#123;
      &quot;name&quot;: &quot;wangminghuan&quot;,
      &quot;email&quot;: &quot;m.h.wang@foxmail.com&quot;,
      &quot;username&quot;: &quot;wangminghuan&quot;
    &#125;,
    &quot;committer&quot;: &#123;
      &quot;name&quot;: &quot;wangminghuan&quot;,
      &quot;email&quot;: &quot;m.h.wang@foxmail.com&quot;,
      &quot;username&quot;: &quot;wangminghuan&quot;
    &#125;,
    &quot;added&quot;: [&quot;dofun.png&quot;],
    &quot;removed&quot;: [],
    &quot;modified&quot;: []
  &#125;],
  &quot;head_commit&quot;: &#123;
    &quot;id&quot;: &quot;9370030232017ff649a070ae6bf1bdd7522a037c&quot;,
    &quot;distinct&quot;: false,
    &quot;message&quot;: &quot;fix:添加文件\n&quot;,
    &quot;timestamp&quot;: 1569831379000,
    &quot;url&quot;: &quot;\u003ca href\u003d\u0027https://coding.net/u/wangminghuan/p/jenkins-autoupload\u0027 target\u003d\u0027_blank\u0027\u003ejenkins-autoupload\u003c/a\u003e/git/commit/9370030232017ff649a070ae6bf1bdd7522a037c&quot;,
    &quot;author&quot;: &#123;
      &quot;name&quot;: &quot;wangminghuan&quot;,
      &quot;email&quot;: &quot;m.h.wang@foxmail.com&quot;,
      &quot;username&quot;: &quot;wangminghuan&quot;
    &#125;,
    &quot;committer&quot;: &#123;
      &quot;name&quot;: &quot;wangminghuan&quot;,
      &quot;email&quot;: &quot;m.h.wang@foxmail.com&quot;,
      &quot;username&quot;: &quot;wangminghuan&quot;
    &#125;,
    &quot;added&quot;: [&quot;dofun.png&quot;],
    &quot;removed&quot;: [],
    &quot;modified&quot;: []
  &#125;,
  &quot;pusher&quot;: &#123;
    &quot;name&quot;: &quot;王明欢&quot;,
    &quot;email&quot;: &quot;m.h.wang@foxmail.com&quot;,
    &quot;username&quot;: &quot;wangminghuan&quot;
  &#125;,
  &quot;sender&quot;: &#123;
    &quot;id&quot;: 2222972,
    &quot;login&quot;: &quot;wangminghuan&quot;,
    &quot;avatar_url&quot;: &quot;https://coding-net-production-static-ci.codehub.cn/e4ed6f51-7033-4c66-bb1c-d567795c88a9.jpg?imageMogr2/auto-orient/format/jpeg/cut/!640x640x0x0&quot;,
    &quot;url&quot;: &quot;https://dev.tencent.com/api/user/key/wangminghuan&quot;,
    &quot;html_url&quot;: &quot;https://dev.tencent.com/u/wangminghuan&quot;,
    &quot;name&quot;: &quot;王明欢&quot;,
    &quot;name_pinyin&quot;: &quot;|wmh|wangminghuan&quot;
  &#125;,
  &quot;repository&quot;: &#123;
    &quot;id&quot;: 4733490,
    &quot;name&quot;: &quot;jenkins-autoupload&quot;,
    &quot;full_name&quot;: &quot;wangminghuan/jenkins-autoupload&quot;,
    &quot;owner&quot;: &#123;
      &quot;id&quot;: 2222972,
      &quot;login&quot;: &quot;wangminghuan&quot;,
      &quot;avatar_url&quot;: &quot;https://coding-net-production-static-ci.codehub.cn/e4ed6f51-7033-4c66-bb1c-d567795c88a9.jpg?imageMogr2/auto-orient/format/jpeg/cut/!640x640x0x0&quot;,
      &quot;url&quot;: &quot;https://dev.tencent.com/api/user/key/wangminghuan&quot;,
      &quot;html_url&quot;: &quot;https://dev.tencent.com/u/wangminghuan&quot;,
      &quot;name&quot;: &quot;王明欢&quot;,
      &quot;name_pinyin&quot;: &quot;|wmh|wangminghuan&quot;
    &#125;,
    &quot;private&quot;: true,
    &quot;html_url&quot;: &quot;\u003ca href\u003d\u0027https://dev.tencent.com/u/wangminghuan/p/jenkins-autoupload\u0027 target\u003d\u0027_blank\u0027\u003ejenkins-autoupload\u003c/a\u003e&quot;,
    &quot;description&quot;: &quot;测试jenkins自动化部署上传&quot;,
    &quot;fork&quot;: false,
    &quot;url&quot;: &quot;https://dev.tencent.com/api/user/wangminghuan/project/jenkins-autoupload&quot;,
    &quot;created_at&quot;: 1568866930000,
    &quot;updated_at&quot;: 1568866930000,
    &quot;clone_url&quot;: &quot;https://git.dev.tencent.com/wangminghuan/jenkins-autoupload.git&quot;,
    &quot;ssh_url&quot;: &quot;git@git.dev.tencent.com:wangminghuan/jenkins-autoupload.git&quot;,
    &quot;default_branch&quot;: &quot;master&quot;
  &#125;
&#125;
</code></pre>
<p>至此，配置基本完毕。</p>
<h2 id="权限部分配置"><a href="#权限部分配置" class="headerlink" title="权限部分配置"></a>权限部分配置</h2><p>通过插件 <code>Role-based Authorization Strategy</code> 配置完成，安装完插件，重启Jenkins，会发现配置页面多一个选项：</p>
<p><img src="28.png"></p>
<p>首先需要在全局安全配置页面将授权策略改为：Role-Based Strategy</p>
<p><img src="31.png"></p>
<p>进入 Manage Role 选项，配置用户角色与所在组角色权限</p>
<p><img src="29.png"></p>
<p>进入 Assign Roles 选项，为用户分配角色（首先需要在用户管理板块创建用户）</p>
<p><img src="30.png"></p>
<p>具体可参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/peng-lan/p/9809644.html">jenkins配置用户角色权限，根据不同权限显示视图、Job</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>docker安装方式比较傻瓜，而且整个插件安装的过程都比较快，但是因为docker就像一个封闭的黑盒，很多东西与系统是隔离开的（废话，设计初衷就是这样），导致我这个菜鸟遇到问题想不到好的解决方案。嗯，还是RPM用起来更顺手一些，遇到问题基本还能应对。最后，不差钱的，请上大内存服务器~</p>
<h2 id="可能用到的linux命令"><a href="#可能用到的linux命令" class="headerlink" title="可能用到的linux命令"></a>可能用到的linux命令</h2><pre><code># 启动docker
systemctl start docker
      
# 停止docker
systemctl stop docker 

# 列出docker内正在运行的容器
docker ps

# 列出docker内的容器
docker ps -a
      
# 启动docker内容器
docker start &lt;id&gt; 
docker restart &lt;id&gt;
docker stop &lt;id&gt;

# 进入docker容器内部执行命令
docker exec -it &lt;id&gt; bash

# 查看jenkins启动状态
systemctl status jenkins.service 

# 查看jenkins日志
sudo tail -f /var/log/jenkins/jenkins.log  查看日志
</code></pre>
<h2 id="补充：增加swap分区解决阿里云内存不足"><a href="#补充：增加swap分区解决阿里云内存不足" class="headerlink" title="补充：增加swap分区解决阿里云内存不足"></a>补充：增加swap分区解决阿里云内存不足</h2><p>发现可以扩展Swap分区，即交换区，系统在物理内存（这里应该是运行内存）不够时，与Swap进行交换，来解决内存不足的问题。设置步奏如下：</p>
<ol>
<li><p>首先创建用于交换分区的文件，并设置交换分区文件</p>
<pre><code> dd if=/dev/zero of=/var/swap bs=1024 count=4096000
</code></pre>
</li>
<li><p>创建 swap 文件</p>
<pre><code> mkswap /var/swap
</code></pre>
</li>
<li><p>加载这个文件</p>
<pre><code> swapon /var/swap
</code></pre>
<p>执行以上命令可能会出现：“不安全的权限 0644，建议使用 0600”提示，其实已经激活了，可以忽略，修改权限：</p>
<pre><code> chmod -R 0600 /var/swap
</code></pre>
</li>
<li><p>设置系统启动时自动挂载分区</p>
<pre><code> echo &quot;/var/swap swap swap defaults 0 0&quot; &gt;&gt; /etc/fstab
</code></pre>
</li>
<li><p>确定系统对SWAP分区的使用原则，当swappiness内容的值为0时，表示最大限度地使用物理内存，物理内存使用完毕后，才会使用SWAP分区。当swappiness内容的值为100时，表示积极地使用SWAP分区，并且把内存中的数据及时地置换到SWAP分区。liunx默认为60，此处我们设置为默认大小60</p>
<pre><code> echo 60 &gt; /proc/sys/vm/swappiness
</code></pre>
</li>
</ol>
<p>再次运用构建命令，查看内存变化，会发现swap区已经得到了利用：</p>
<p><img src="32.png"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zwcry/p/9602756.html">Systemd 入门教程：实战篇</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/yangzaizi/article/details/83505026">Jenkins入门教程之linux下安装配置jenkins(rpm方式)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lazycheerup/article/details/83928548">jenkins yum 安装</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/jenkins/" rel="tag"># jenkins</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/ArrayBuffer%20TypedArray%E5%92%8CDataView/" rel="prev" title="ArrayBuffer TypedArray和DataView">
                  <i class="fa fa-chevron-left"></i> ArrayBuffer TypedArray和DataView
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Nodejs%E7%B3%BB%E5%88%97-1-%E5%9F%BA%E7%A1%80/" rel="next" title="Nodejs系列-1-基础">
                  Nodejs系列-1-基础 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WMH</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://static.wangminghuan.cn/cdn/animejs@3.2.1/anime.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://static.wangminghuan.cn/cdn/hexo-generator-searchdb/search.js"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
