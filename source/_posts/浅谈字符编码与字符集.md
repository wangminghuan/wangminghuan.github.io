---
title: 浅谈字符编码与字符集
date: 2020-06-31 15:05:25
tags: ['字符','编码']
categories: web
---
## 概述

我们知道，计算机内部，所有信息最终都是一个二进制值。每一个二进制位（bit）有0和1两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个字节（byte）。也就是说，一个字节一共可以用来表示256种不同的状态，每一个状态对应一个符号，就是256个符号，从00000000到11111111。

上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的对应关系，做了统一规定。这被称为 ASCII 码。ASCII 码一共规定了128个字符的编码，这对英文来说是够用的，但是对于中文来说就远远不够了。每个国家就各自来对 ASCII 字符集做了拓展，最具代表性的就是国内的 GB 类的汉字编码模式，如GB2312字符集。

但当各国互相接轨时就出现了问题：世界上各国都有不同的编码方式（虽然都兼容了ASCII码），同一个二进制数字可以被解码成不同的符号。因此，要想打开一个文本文件，就必须知道它的编码方式，否则用错误的编码方式解读，就会出现乱码。这时候为了解决这个问题，最终的集大成者 Unicode 字符集出现了，它将世界上所有的符号都纳入其中，成功实现了每个数字代表唯一的至少在某种语言中使用的符号。
<!-- more -->

## Unicode
Unicode 表示的是一个字符集（注意不是编码方式），但是它衍生出来的编码方案却有三种，分别是 UTF-32、UTF-16 和 UTF-8。而ASCII、GBK 等类编码模式的字符集和编码方式都是一一对应的。

### UTF-8

UTF-8 就是在互联网上使用最广的一种 Unicode 的实现方式：

- 对于只有一个字节的符号，字节的第一位设为0，后面 7 位为这个符号的 Unicode 码。此时，对于英语字母UTF-8 编码和 ASCII 码是相同的
- 对于 n 字节的符号（n > 1），第一个字节的前 n 位都设为 1，第 n + 1 位设为0，后面字节的前两位一律设为 10。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码


### UTF-16 与 UTF-32

UTF-16（字符用两个字节或四个字节表示）和 UTF-32（字符用四个字节表示）都是用固定字节来存储，

只有 UTF-8 兼容 ASCII，UTF-32 和 UTF-16 都不兼容 ASCII，因为它们没有单字节编码。

### BOM

BOM即Byte Order Mark字节序标记。BOM是为UTF-16和UTF-32准备的，用户标记字节序（byte order）。

### UTF-8 BOM

UTF-8 BOM又叫UTF-8 签名，UTF-8不需要BOM来表明字节顺序，但可以用BOM来表明编码方式。当文本程序读取到以 EF BB BF开头的字节流时，就知道这是UTF-8编码了。Windows就是使用BOM来标记文本文件的编码方式的

我们将一个文本保存为utf-8 带BOM格式，使用fs模块读取(fs.readFile)下文件，得到：

      <Buffer ef bb bf e5 93 88 e5 93 88>

我们再将其保存为utf-8 无 BOM格式，得到：

      <Buffer e5 93 88 e5 93 88>
### UTF-16 LE 与 UTF-16 BE
UTF-16，是定长编码，是双字节编码，所以两个字节保存时哪个在前，哪个在后关系到解析出字符的结果。

UTF-16BE (little endian), 俗称小头；UTF-16BE (big endian), 俗称大头；

出现 BE 和 LE 的编码，则是由于历史原因造成的：在 Mac 和 PC 机上，对字节顺序的理解是不一致的。如果一个文件不明确说明 UTF16 使用的是 BE 还是 LE，那么就需要通过 BOM 来指明了, 一般X86机器上都是UTF-16LE。其开始的两个字节也表示该字节数组是大端还是小端：FE FF表示大端，FF FE表示小端。

同样，我们分别读取一个UTF-16LE的文本与UTF-16BE的文本，结果如下：

    UTF-16LE (little endian)

        <Buffer ff fe c8 54 c8 54>

    UTF-16BE (big endian)

        <Buffer fe ff 54 c8 54 c8>

PS: win10 中记事本功能相比win7做了升级，编码方式更一目了然：

- 旧版的“Unicode”相当于新版的“UTF-16 LE”；
- 旧版的“Unicode big endian”相当于新版的“UTF-16 BE”；

##  参考
- [Java技术栈：看完这篇，你也是字符编码大神！](https://mp.weixin.qq.com/s/1BtBnne5Jm4gPGCRfjoZ9w)
- [阮一峰：字符编码笔记：ASCII，Unicode 和 UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)